<#include "../../../include/header.html">
<script type="text/javascript">
    var viewModel = kendo.observable({
        model: {},
        saveFunction: function () {
            $('#Grid').data('kendoGrid').saveChanges();
        },
        queryFunction: function (e) {
            $('#Grid').data('kendoGrid').dataSource.page(1);
        },
        resetFunction: function (e) {
            var formData = viewModel.model.toJSON();
            for (var k in formData) {
                viewModel.model.set(k, null);
            }
        }
    });
</script>
<body>
<div id="page-content">
<div class="pull-left" id="toolbar-btn" style="padding-bottom:10px;">
        <span onclick="deleteData()" class="btn btn-danger" style="float:left;"><@spring.message "hap.delete"/></span>
    </div>
    <script>kendo.bind($('#toolbar-btn'), viewModel);</script>
<div class="pull-right" id="queryPanel" padding-bottom:10px; border:none;box-shadow: none;">
			<div class="k-query-simple" id="query-form">
			<form class="form-horizontal" id="myForm" padding-bottom:10px;>
				<div class="col-sm-4">
					<div class="form-group">
						<label class="col-sm-4 control-label">物业公司</label>
						<div class="col-sm-8">
							<div style="float:left;margin-right:5px;">
                <input type="text" id="companyId" placeholder='物业公司'
                       style="width:150px;" data-bind="value:model.companyId">
                <script>
                    $("#companyId").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "LOV_COMPANY")}, {
                    }))
                </script>
                          </div>
						</div>
					</div>
				</div>
				
				<div class="col-sm-4">
					<div class="form-group">
						<label class="col-sm-4 control-label">项目名称</label>
						<div class="col-sm-8">
							<div style="float:left;margin-right:5px;">
                <input type="text" id="communityId" placeholder='项目名称'
                       style="width:150px;" data-bind="value:model.communityId">
                <script>
                    $("#communityId").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "COMMUNITY_LOV")}, {
                    }))
                </script>
                          </div>
						</div>
					</div>
				</div>

				<div class="col-sm-4">
					<div class="form-group">
						<label class="col-sm-4 control-label">文本内容</label>
						<div class="col-sm-8">
							<input type="text" style="width: 100%"
								data-bind="value:model.topicContent" class="k-textbox">
						</div>
					</div>
				</div>
			</div>
			</form>
			
			<script>
				kendo.bind($('#query-form'), viewModel);
			</script>

			<!--<div class="k-query-detail" id="query-form2" padding-bottom:10px;>-->
				<!--<div class="rows" style="margin-top: 20px">-->
				<!--<div class="col-sm-4" style="margin-top: 10px;margin-bottom: 20px">-->
						<!--<div class="form-group">-->
							<!--<label class="col-sm-4 control-label">分类</label>-->
							<!--<div class="col-sm-8">-->
							<!--<div style="float:left;margin-right:5px;">-->
                <!--<input type="text" id="typeId" placeholder='分类'-->
                       <!--style="width:150px;" data-bind="value:model.typeId">-->
                <!--<script>-->
                    <!--$("#typeId").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "NEIGHBOR_TAG_LOV")}, {-->
                    <!--}))-->
                <!--</script>-->
                          <!--</div>-->
                            <!--</div>-->
						<!--</div>-->
					<!--</div>-->

					<!--<div class="col-sm-4" style="margin-top: 10px;margin-bottom: 20px">-->
						<!--<div class="form-group">-->
							<!--<label class="col-sm-4 control-label">发布时间从</label>-->
							<!--<div class="col-sm-8">-->
								<!--<input style="width: 100%" data-role="datetimepicker"-->
									<!--data-bind="value:model.startTime" class="k-datetimepicker">-->
							<!--</div>-->
						<!--</div>-->
					<!--</div>-->

					<!--<div class="col-sm-4" style="margin-top: 10px;margin-bottom: 20px">-->
						<!--<div class="form-group">-->
							<!--<label class="col-sm-4 control-label">发布时间至</label>-->
							<!--<div class="col-sm-8">-->
								<!--<input style="width: 100%" data-role="datetimepicker"-->
									   <!--data-bind="value:model.endTime" class="k-datetimepicker">-->
							<!--</div>-->
						<!--</div>-->
					<!--</div>-->
				<!--</div>-->


				<!--<div class="rows" style="margin-top: 20px;margin-bottom: 20px">-->
					<!--<div class="col-sm-4">-->
						<!--<div class="form-group">-->
							<!--<label class="col-sm-4 control-label">手机号</label>-->
							<!--<div class="col-sm-8">-->
								<!--<input type="text" style="width: 100%"-->
									   <!--data-bind="value:model.topicContent" class="k-textbox">-->
							<!--</div>-->
						<!--</div>-->
					<!--</div>-->
				<!--</div>-->

				<!--<div class="rows"></div>-->
			<!--</div>-->


	<div class="k-query-detail" id="query-form2" >
		<div class="rows">
			<div class="col-sm-4" style="margin-bottom: 10px">
				<div class="form-group">
					<label class="col-sm-4 control-label">分类</label>
					<div class="col-sm-8">
						<div style="float:left;margin-right:5px;">
							<input type="text" id="typeId" placeholder='分类'
								   style="width:150px;" data-bind="value:model.typeId">
							<script>
                                $("#typeId").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "NEIGHBOR_TAG_LOV")}, {
                                }))
							</script>
						</div>
					</div>
				</div>
			</div>

			<div class="col-sm-4" style="margin-bottom: 10px">
				<div class="form-group">
					<label class="col-sm-4 control-label">发布时间从</label>
					<div class="col-sm-8">
						<input style="width: 100%" data-role="datetimepicker"
							   data-bind="value:model.startTime" class="k-datetimepicker">
					</div>
				</div>
			</div>
			<div class="col-sm-4" style="margin-bottom: 10px">
				<div class="form-group">
					<label class="col-sm-4 control-label">发布时间至</label>
					<div class="col-sm-8">
						<input style="width: 100%" data-role="datetimepicker"
							   data-bind="value:model.endTime" class="k-datetimepicker">
					</div>
				</div>
			</div>
		</div>

		<div class="rows" style="margin-top: 10px">
			<div class="col-sm-4" style="margin-top: 10px;margin-bottom: 20px">
				<div class="form-group">
					<label class="col-sm-4 control-label">手机号</label>
					<div class="col-sm-8">
						<input type="text" style="width: 100%"
							   data-bind="value:model.mobile" class="k-textbox">
					</div>
				</div>
			</div>
		</div>
	</div>

			<script>
				kendo.bind($('#query-form2'), viewModel);
			</script>
		</div>
		
		<script>
        $('#queryPanel').kendoQueryPanel({
            queryFunction: function () {
                viewModel.queryFunction();
            },
            resetFunction: function () {
                viewModel.resetFunction();
            }
        })
    </script>

		<div style="clear: both;">
			<div id="Grid"></div>
			<div id="topicDetail"></div>
		</div>
	</div>
<script type="text/javascript">
    var BaseUrl = _basePath;
    dataSource = new kendo.data.DataSource({
        transport: {
            read: {
                url: BaseUrl + "/csp/ljh/neighbor/topic/query",
                type: "POST",
                dataType: "json"
            },
            update: {
                url: BaseUrl + "/csp/ljh/neighbor/topic/submit",
                type: "POST",
                contentType: "application/json"
            },
            destroy: {
                url: BaseUrl + "/csp/ljh/neighbor/topic/remove",
                type: "POST",
                contentType: "application/json"
            },
            create: {
                url: BaseUrl + "/csp/ljh/neighbor/topic/submit",
                type: "POST",
                contentType: "application/json"
            },
            parameterMap: function (options, type) {
                if (type !== "read" && options.models) {
                    var datas = Hap.prepareSubmitParameter(options, type)
                    return kendo.stringify(datas);
                } else if (type === "read") {
                    return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                }
            }
        },
        batch: true,
        serverPaging: true,
        pageSize: 10,
        schema: {
            data: 'rows',
            total: 'total',
            model: {
                id: "id",
                fields: {}
            }
        }
    });

    $("#Grid").kendoGrid({
        dataSource: dataSource,
        height: '100%',
        resizable: true,
        scrollable: true,
        navigatable: false,
        selectable: 'multiple, rowbox',
        pageable: {
            pageSizes: [5, 10, 20, 50],
            refresh: true,
            buttonCount: 5
        },
        columns: [{
                field: "companyName",
                title: '物业公司',
                width: 100
            },{
                field: "communityName",
                title: '项目名称',
                width: 100
            },
               {
                field: "typeName",
                title: '分类',
                width: 80
            },
                    
                    {
                field: "topicContent",
                title: '文本内容',
                width: 220
            },
                    {
                field: "commentNum",
                title: '评论数',
                width: 80
            },
                    {
                field: "praiseNum",
                title: '赞数',
                width: 80
            },
            {
                field: "publisher",
                title: '发布者',
                width: 100
            },
            {
                field: "mobile",
                title: '手机号',
                width: 100
            },
            {
                field: "publishTime",
                title: '发布时间',
                width: 80
            },
            {
                        title: '操作',
                        width: 160,
                        template: function (rowdata) {
                            return "<a href='#' onclick='topicEdit(\"" + rowdata.id + "\")'>详情</a>&nbsp;&nbsp;&nbsp;&nbsp;";
                             },
                    }
        ],
        editable: false
    });

    function deleteData() {

        Hap.deleteGridSelection({
            grid: $('#Grid')
        });

    }
    Hap.autoResizeGrid("#Grid");
    
    //编辑记录
    var __baseUrl = "${base.contextPath}/module/operate/neighbor/";
            function topicEdit(id) {
                $("#topicDetail").kendoWindow({
                    width: "85%",
                    height: "91%",
                    actions: [
                        "Pin",
                        "Minimize",
                        "Maximize",
                        "Close"
                    ],
                    content: __baseUrl + "topic_detail.html?id=" + id,
                    modal: true,
                    visible: false,
                    iframe: true
                });
                var topicDetails = $("#topicDetail").data("kendoWindow");
                topicDetails.title('互动详情').center().open();
            }
            

</script>
</body>
</html>